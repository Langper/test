var app = angular.module('myUpload', ['pascalprecht.translate','angularFileUpload']);

// 配置config，读取相应国际化语言json文档
app.config(['$translateProvider', function ($translateProvider) {

  $translateProvider.translations('zh-CN',key_value_cn);
  $translateProvider.translations('zh-TW',key_value_tw);
  $translateProvider.translations('en-US',key_value_us);

  var lang;
  if (localStorage.lang == null)
  {
    lang = 'zh-CN';
  }
  else {
    lang = localStorage.lang;
  }
  $translateProvider.preferredLanguage(lang);

 }]);

//first
app.controller('myUploadCrl', function($scope, $http,FileUploader) {
if (localStorage.token == null)
{
  location.href = "login.html";
}
var uploader = $scope.uploader = new FileUploader({
// url:'http://gscm-api.efoxconn.com:81/v1.0/users/excel',
  // url:'http://localhost:5000/v1.0/pc_commit/excel?user_id='+ localStorage.id,
  method: 'POST',
  queueLimit: 1,//文件个数
//  autoUpload: true,
 alias:"excel"
});

$scope.show_loading = false;
uploader.onBeforeUploadItem = function(item,response, status, headers)
{
  var url = 'http://localhost:5000/v1.0/pc_commit/excel?user_id='+localStorage.id;
  item.url = url;
}
uploader.onProgressItem = function(item,response,status,headers){
$scope.show_loading = true;
}
uploader.onWhenAddingFileFailed= function(item, filter, options){
uploader.removeFromQueue(0);
uploader.addToQueue(item);
}
uploader.onAfterAddingFile = function(item){
$scope.show_loading = false;
console.log(uploader.queue);
}
uploader.onSuccessItem = function(item, response, status, headers) {

  $scope.show_loading = false;
};

uploader.onErrorItem = function(item, response, status, headers) {
alert(response.message);
$scope.show_loading = false;
};

$scope.UploadFile = function(){
  uploader.uploadAll();
};


});

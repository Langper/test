<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="GSCM,Global SCM,Global Supply Chain Management">
    <meta name="description" content="GSCM 是 FG-IT 根据组织对供应链管理需求，专门设计的共用平台解决方案。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Upload excel</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/font-awesome.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">
    <link rel="stylesheet" href="/css/mycss.css">
    <script src="/js/angular-1.6.6/angular.min.js"></script>
    <!-- 国际化 -->
    <script src="/js/angular-1.6.6/angular-translate.min.js"></script>
    <script src="/js/angular-1.6.6/loader-static-files.js"></script>
    <!-- 上传文件 -->
    <!-- <script src="/static/js/angular-1.6.6/ng-file-upload.min.js"></script>
    <script src="/static/js/angular-1.6.6/ng-file-upload-shim.min.js"></script> -->
    <script src="/js/angular-1.6.6/angular-file-upload.min.js"></script>
    <script src="/js/angular-1.6.6/angular-file-upload.js"></script>
    <script src="./i18n/zh-CN.js"></script>
    <script src="./i18n/zh-TW.js"></script>
    <script src="./i18n/en-US.js"></script>
    <script type="text/javascript">
        // 国际化注入依赖‘pascalprecht.translate’

        var app = angular.module('myUpload', ['pascalprecht.translate','angularFileUpload']);

        // 配置config，读取相应国际化语言json文档
        app.config(['$translateProvider', function ($translateProvider) {

          $translateProvider.translations('zh-CN',key_value_cn);
          $translateProvider.translations('zh-TW',key_value_tw);
          $translateProvider.translations('en-US',key_value_us);

          var lang;
          if (localStorage.lang == null)
          {
            lang = 'zh-CN';
          }
          else {
            lang = localStorage.lang;
          }
          $translateProvider.preferredLanguage(lang);

         }]);

//first
    app.controller('myUploadCrl', function($scope,$http,FileUploader) {
      if (localStorage.token == null)
      {
        location.href = "login.html";
      }
      var id;
      if (localStorage.id==null) {
        location.href = "login.html";
      }
      else {
        id=localStorage.id;
      }
      var uploader = $scope.uploader = new FileUploader({
        // url:'http://gscm-api.efoxconn.com:81/v1.0/users/excel',
          url:'http://localhost:59498/v1.0/CustomerPo/pdf?user_id='+id,
          method: 'POST',
          queueLimit: 100,//文件个数
        //  autoUpload: true,
         alias:"user_excel"
      });

      uploader.onSuccessItem = function(item, response, status, headers) {

      };

      uploader.onErrorItem = function(item, response, status, headers) {
        alert(response.message);
      };
      uploader.onCompleteAll = function(){

        $http.get("http://localhost:5000/v1.0/customer_po/price")
        .then(function success(response) {
          alert("Check price successfully!")
        },function error(response) {
          alert(response.data.message);
        });
        // alert("onCompleteAll !");
      }
      $scope.UploadFile = function(){
          uploader.uploadAll();
      };


    });
    </script>

    <script src="/js/jquery.min.js?v=2.1.4"></script>
    <script>
      $(document).ready(function(){
        $("#btnChooseFile").click(function(){
          $("#user_excel").click();
        });
      });
    </script>

</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row" ng-app="myUpload" ng-controller="myUploadCrl" ng-cloak>
            <div class="col-sm-12">
                    <div class="ibox float-e-margins">
                      <div class="ibox-content">
                              <br>
                              <h3 id="queueLength">{{"choose_file_num" | translate}} : {{ uploader.queue.length }}</h3>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th width="50%">{{"file_name" | translate}}</th>
                                            <th ng-show="uploader.isHTML5">{{"file_size" | translate}}</th>
                                            <th ng-show="uploader.isHTML5">{{"progress" | translate}}</th>
                                            <th>{{"status" | translate}}</th>
                                            <th>{{"operation" | translate}}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in uploader.queue">
                                            <td><strong>{{ item.file.name }}</strong></td>
                                            <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td>
                                            <td ng-show="uploader.isHTML5">
                                                <div class="progress" style="margin-bottom: 0;">
                                                    <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                                                <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                                                <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                                            </td>
                                            <td nowrap>
                                                <button type="button" class="btn btn-primary btn-xs" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                                                    <span class="glyphicon glyphicon-upload"></span> {{"upload" | translate}}
                                                </button>

                                                <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                                    <span class="glyphicon glyphicon-trash"></span> {{"remove" | translate}}
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div>
                                    <div>
                                        {{"progress" | translate}}:
                                        <div class="progress" style="">
                                            <div class="progress-bar" role="progressbar" ng-style="{ 'width': uploader.progress + '%' }"></div>
                                        </div>
                                    </div>
                                    <div  style="float:left;" class="hidden-object">
                                      <input class="btn-sm" style="margin:4px 0;" type="file" id="user_excel" name="user_excel" nv-file-select accept=".pdf" uploader="uploader" multiple="ture"/>
                                      <!-- <h3 style="float:left;height:30px;line-height:30px;">Upload queue length: {{ uploader.queue.length }}</h3> -->
                                    </div>
                                    <div style="float:left;">
                                      <button type="button" class="btn btn-sm btn-primary" id="btnChooseFile">{{"choose_file" | translate}}</button>
                                    </div>
                                    <div style="float:right;">
                                      <button type="button" class="btn btn-sm btn-primary" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length">
                                          <span class="glyphicon glyphicon-upload"></span> {{"upload_all" | translate}}
                                      </button>
                                        <!-- <button type="button" class="btn btn-warning btn-s" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading">
                                            <span class="glyphicon glyphicon-ban-circle"></span> Cancel all
                                        </button> -->
                                        <button type="button" class="btn btn-sm btn-danger" ng-click="uploader.clearQueue()" ng-disabled="!uploader.queue.length">
                                            <span class="glyphicon glyphicon-trash"></span> {{"remove_all" | translate}}
                                        </button>
                                    </div>
                                      <div style="clear:both;">

                                      </div>
                                </div>

                          </div>
                              <!-- <span ng-repeat="item in uploader.queue">
                                 {{item.file.name}}
                              </span>
                              <input class="form-control" ng-model="filename" readonly/>
                              <button type="button" class="btn" ng-click="export()">导出</button> -->
                          </div>
                        </div>
                    </div>

            </div>
        </div>

    </div>

    <!-- 全局js -->
    <script src="/js/bootstrap.min.js?v=3.3.6"></script>



    <script src="/js/plugins/jeditable/jquery.jeditable.js"></script>

    <!-- Data Tables -->
    <script src="/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/js/plugins/dataTables/dataTables.bootstrap.js"></script>

    <!-- 自定义js -->
    <script src="/js/content.js?v=1.0.0"></script>


</body>

</html>

    
    
    
